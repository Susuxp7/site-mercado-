<!doctype html>
<html lang="pt-BR"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Checkout</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"><link rel="stylesheet" href="css/style.css"></head>
<body><nav class="navbar navbar-dark bg-success"><div class="container"><a class="navbar-brand" href="index.html">Meu Mercado</a></div></nav>
<main class="container my-4">
  <h2>Finalizar Compra</h2>
  <form id="checkout-form" class="row g-3">
    <div class="col-md-6"><input name="name" class="form-control" placeholder="Nome completo" required></div>
    <div class="col-md-6"><input name="address" class="form-control" placeholder="EndereÃ§o de entrega" required></div>
    <div class="col-12"><button class="btn btn-success">Enviar Pedido</button></div>
  </form>
</main>
<script>
const API = (location.hostname==='localhost'||location.hostname==='127.0.0.1')?'http://localhost:4000/api':'/api';
document.getElementById('checkout-form').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const fd = new FormData(e.target);
  const cart = JSON.parse(localStorage.getItem('cart')||'[]');
  if (!cart.length) return alert('Carrinho vazio');
  const total = cart.reduce((s,i)=>s+i.price*i.q,0);
  const body = { customer_name: fd.get('name'), customer_address: fd.get('address'), items: cart, total };
  const res = await fetch(API + '/orders', {
    method: 'POST', headers: { 'Content-Type':'application/json' }, body: JSON.stringify(body)
  });
  if (res.ok) { localStorage.removeItem('cart'); alert('Pedido enviado!'); location.href='index.html'; }
  else { const j = await res.json(); alert('Erro: ' + (j.error||'')); }
});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script></body></html>
